!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):e.ReactInputMask=t(e.React)}(this,function(e){"use strict";function t(){var e=new RegExp("windows","i"),t=new RegExp("firefox","i"),n=new RegExp("android","i"),s=navigator.userAgent;return!e.test(s)&&!t.test(s)&&n.test(s)}function n(){var e=new RegExp("windows","i"),t=new RegExp("phone","i"),n=navigator.userAgent;return e.test(n)&&t.test(n)}function s(){var e=new RegExp("windows","i"),t=new RegExp("firefox","i"),n=new RegExp("android","i"),s=navigator.userAgent;return!e.test(s)&&t.test(s)&&n.test(s)}function a(e,t){return-1!==e.permanents.indexOf(t)}function o(e,t,n){var s=e.mask,o=e.charsRules;if(!n)return!1;if(a(e,t))return s[t]===n;var r=o[s[t]];return new RegExp(r).test(n)}function r(e,t){return t.split("").every(function(t,n){return a(e,n)||!o(e,n,t)})}function i(e,t){var n=e.maskChar,s=e.prefix;if(!n){for(;t.length>s.length&&a(e,t.length-1);)t=t.slice(0,t.length-1);return t.length}for(var r=s.length,i=t.length;i>=s.length;i--){var l=t[i];if(!a(e,i)&&o(e,i,l)){r=i+1;break}}return r}function l(e,t){return i(e,t)===e.mask.length}function u(e,t){var n=e.maskChar,s=e.mask,o=e.prefix;if(!n)return t=c(e,"",t,0),(t=t.slice(0,i(e,t))).length<o.length&&(t=o),t;if(t)return c(e,u(e,""),t,0);for(var r=0;r<s.length;r++)a(e,r)?t+=s[r]:t+=n;return t}function p(e,t,n,s){var o=n+s,r=e.maskChar,i=e.mask,l=e.prefix,p=t.split("");return r?p.map(function(t,s){return s<n||s>=o?t:a(e,s)?i[s]:r}).join(""):(n=Math.max(l.length,n),p.splice(n,o-n),t=p.join(""),u(e,t))}function c(e,t,n,s,r){var i=e.mask,p=e.maskChar,c=e.prefix,f=n.split(""),h=l(e,t),m=function(t,n){return!a(e,t)||n===i[t]},g=function(t,n){return!p||!a(e,n)||t!==p};return!p&&s>t.length&&(t+=i.slice(t.length,s)),f.every(function(n){for(;!m(s,n);){if(s>=t.length&&(t+=i[s]),!g(n,s))return!0;if(++s>=i.length)return!1}return o(e,s,n)||n===p?(s<t.length?p||h||s<c.length?t=t.slice(0,s)+n+t.slice(s+1):(t=t.slice(0,s)+n+t.slice(s),t=u(e,t)):p||(t+=n),++s<i.length):("function"==typeof r&&r(),!0)}),t}function f(e,t,n,s){var r=e.mask,i=e.maskChar,l=n.split(""),u=s,p=function(t,n){return!a(e,t)||n===r[t]};return l.every(function(t){for(;!p(s,t);)if(++s>=r.length)return!1;return(o(e,s,t)||t===i)&&s++,s<r.length}),s-u}function h(e,t){var n={};for(var s in e)t.indexOf(s)>=0||Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=e[s]);return n}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}e=e&&e.hasOwnProperty("default")?e["default"]:e;var k={9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},d=function(e,t,n){if(t===undefined&&(t="_"),null==n&&(n=k),!e||"string"!=typeof e)return{maskChar:t,charsRules:n,mask:null,prefix:null,lastEditablePos:null,permanents:[]};var s="",a="",o=[],r=!1,i=null;return e.split("").forEach(function(e){r||"\\"!==e?(r||!n[e]?(o.push(s.length),s.length===o.length-1&&(a+=e)):i=s.length+1,s+=e,r=!1):r=!0}),{maskChar:t,charsRules:n,prefix:a,mask:s,lastEditablePos:i,permanents:o}},O=function(e){return(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(){return setTimeout(e,0)})(e)},y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},w=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),C=function(a){function o(e){m(this,o);var t=g(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));E.call(t);var n=e.mask,s=e.maskChar,a=e.formatChars,r=e.defaultValue,i=e.value,l=e.alwaysShowMask,p=e.invalidCharCallback;return t.hasValue=null!=i,t.maskOptions=d(n,s,a),t.invalidCharCallback=p,null==r&&(r=""),null==i&&(i=r),i=t.getStringValue(i),t.maskOptions.mask&&(l||i)&&(i=u(t.maskOptions,i)),t.value=i,t}return v(o,e.Component),w(o,[{key:"componentDidMount",value:function(){this.isAndroidBrowser=t(),this.isWindowsPhoneBrowser=n(),this.isAndroidFirefox=s(),this.maskOptions.mask&&this.getInputValue()!==this.value&&this.setInputValue(this.value)}},{key:"componentWillReceiveProps",value:function(e){var t=this.maskOptions;if(this.hasValue=null!=e.value,this.maskOptions=d(e.mask,e.maskChar,e.formatChars),!this.maskOptions.mask)return this.backspaceOrDeleteRemoval=null,void(this.lastCursorPos=null);var n=this.maskOptions.mask&&this.maskOptions.mask!==t.mask,s=e.alwaysShowMask||this.isFocused(),a=this.hasValue?this.getStringValue(e.value):this.value;if(t.mask||this.hasValue||(a=this.getInputDOMNode().value),(n||this.maskOptions.mask&&(a||s))&&(a=u(this.maskOptions,a),n)){var o=this.lastCursorPos,p=i(this.maskOptions,a);(null===o||p<o)&&(o=l(this.maskOptions,a)?p:this.getRightEditablePos(p),this.setCursorPos(o))}!this.maskOptions.mask||!r(this.maskOptions,a)||s||this.hasValue&&e.value||(a=""),this.value=a}},{key:"componentDidUpdate",value:function(){this.maskOptions.mask&&this.getInputValue()!==this.value&&this.setInputValue(this.value)}},{key:"render",value:function(){var t=this,n=this.props,s=(n.mask,n.alwaysShowMask,n.maskChar,n.formatChars,n.invalidCharCallback,h(n,["mask","alwaysShowMask","maskChar","formatChars","invalidCharCallback"]));return this.maskOptions.mask&&(s.disabled||s.readOnly||["onChange","onKeyDown","onPaste"].forEach(function(e){s[e]=t[e]}),null!=s.value&&(s.value=this.value)),e.createElement("input",b({ref:function(e){return t.input=e}},s,{onFocus:this.onFocus,onBlur:this.onBlur}))}}]),o}(),E=function(){var t=this;this.lastCursorPos=null,this.focused=!1,this.isDOMElement=function(e){return"object"===("undefined"==typeof HTMLElement?"undefined":y(HTMLElement))?e instanceof HTMLElement:1===e.nodeType&&"string"==typeof e.nodeName},this.getInputDOMNode=function(){var n=t.input;return n?t.isDOMElement(n)?n:e.findDOMNode(n):null},this.getInputValue=function(){var e=t.getInputDOMNode();return e?e.value:null},this.setInputValue=function(e){var n=t.getInputDOMNode();n&&(t.value=e,n.value=e)},this.getLeftEditablePos=function(e){for(var n=e;n>=0;--n)if(!a(t.maskOptions,n))return n;return null},this.getRightEditablePos=function(e){for(var n=t.maskOptions.mask,s=e;s<n.length;++s)if(!a(t.maskOptions,s))return s;return null},this.setCursorToEnd=function(){var e=i(t.maskOptions,t.value),n=t.getRightEditablePos(e);null!==n&&t.setCursorPos(n)},this.setSelection=function(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0,s=t.getInputDOMNode();if(s){var a=e+n;if("selectionStart"in s&&"selectionEnd"in s)s.selectionStart=e,s.selectionEnd=a;else{var o=s.createTextRange();o.collapse(!0),o.moveStart("character",e),o.moveEnd("character",a-e),o.select()}}},this.getSelection=function(){var e=t.getInputDOMNode(),n=0,s=0;if("selectionStart"in e&&"selectionEnd"in e)n=e.selectionStart,s=e.selectionEnd;else{var a=document.selection.createRange();a.parentElement()===e&&(n=-a.moveStart("character",-e.value.length),s=-a.moveEnd("character",-e.value.length))}return{start:n,end:s,length:s-n}},this.getCursorPos=function(){return t.getSelection().start},this.setCursorPos=function(e){t.setSelection(e,0),O(function(){t.setSelection(e,0)}),t.lastCursorPos=e},this.isFocused=function(){return t.focused},this.getStringValue=function(e){return e||0===e?e+"":""},this.onKeyDown=function(e){t.backspaceOrDeleteRemoval=null,"function"==typeof t.props.onKeyDown&&t.props.onKeyDown(e);var n=e.key,s=e.ctrlKey,a=e.metaKey,o=e.defaultPrevented;if(!(s||a||o||"Backspace"!==n&&"Delete"!==n)){var r=t.getSelection();if(!("Backspace"===n&&r.end>0||"Delete"===n&&t.value.length>r.start))return;t.backspaceOrDeleteRemoval={key:n,selection:t.getSelection()}}},this.onChange=function(e){var n=t.paste,s=t.invalidCharCallback,a=t.maskOptions,o=a.mask,r=a.maskChar,l=a.lastEditablePos,f=a.prefix,h=t.getInputValue(),m=t.value;if(n)return t.paste=null,void t.pasteText(n.value,h,n.selection,e);var g,v,k=t.getSelection(),d=k.end,y=o.length,b=h.length,w=m.length;if(t.backspaceOrDeleteRemoval){var C="Delete"===t.backspaceOrDeleteRemoval.key;if(h=t.value,k=t.backspaceOrDeleteRemoval.selection,d=k.start,t.backspaceOrDeleteRemoval=null,k.length)h=p(t.maskOptions,h,k.start,k.length);else if(k.start<f.length||!C&&k.start===f.length)d=f.length;else{var E=C?t.getRightEditablePos(d):t.getLeftEditablePos(d-1);null!==E&&(h=p(t.maskOptions,h,E,1),d=E)}}else if(b>w){var P=b-w,R=k.end-P;v=h.substr(R,P),d=R<l&&(1!==P||v!==o[R])?t.getRightEditablePos(R):R,h=h.substr(0,R)+h.substr(R+P),g=p(t.maskOptions,h,R,y-R),g=c(t.maskOptions,g,v,d,s),h=c(t.maskOptions,m,v,d,s),1!==P||d>=f.length&&d<l?(d=Math.max(i(t.maskOptions,g),d))<l&&(d=t.getRightEditablePos(d)):d<l&&d++}else if(b<w){var x=y-b,S=(v=h.substr(0,k.end))===m.substr(0,k.end);g=p(t.maskOptions,m,k.end,x),r&&(h=c(t.maskOptions,g,v,0,s)),g=p(t.maskOptions,g,k.end,y-k.end),g=c(t.maskOptions,g,v,0,s),S?d<f.length&&(d=f.length):(d=Math.max(i(t.maskOptions,g),d))<l&&(d=t.getRightEditablePos(d))}h=u(t.maskOptions,h),t.setInputValue(h),"function"==typeof t.props.onChange&&t.props.onChange(e),t.isWindowsPhoneBrowser?O(function(){t.setSelection(d,0)}):t.setCursorPos(d)},this.onFocus=function(e){if(t.focused=!0,t.maskOptions.mask)if(t.value)i(t.maskOptions,t.value)<t.maskOptions.mask.length&&t.setCursorToEnd();else{var n=t.maskOptions.prefix,s=u(t.maskOptions,n),a=u(t.maskOptions,s),o=a!==e.target.value;o&&(e.target.value=a),t.value=a,o&&"function"==typeof t.props.onChange&&t.props.onChange(e),t.setCursorToEnd()}"function"==typeof t.props.onFocus&&t.props.onFocus(e)},this.onBlur=function(e){if(t.focused=!1,t.maskOptions.mask&&!t.props.alwaysShowMask&&r(t.maskOptions,t.value)){var n=""!==t.getInputValue();n&&t.setInputValue(""),n&&"function"==typeof t.props.onChange&&t.props.onChange(e)}"function"==typeof t.props.onBlur&&t.props.onBlur(e)},this.onPaste=function(e){"function"==typeof t.props.onPaste&&t.props.onPaste(e),t.isAndroidBrowser&&!e.defaultPrevented&&(t.paste={value:t.getInputValue(),selection:t.getSelection()},t.setInputValue(""))},this.pasteText=function(e,n,s,a){var o=s.start;s.length&&(e=p(t.maskOptions,e,o,s.length));var r=f(t.maskOptions,0,n,o);e=c(t.maskOptions,e,n,o,t.invalidCharCallback),o+=r,o=t.getRightEditablePos(o)||o,e!==t.getInputValue()&&(t.setInputValue(e),a&&"function"==typeof t.props.onChange&&t.props.onChange(a)),t.setCursorPos(o)}};return C});
